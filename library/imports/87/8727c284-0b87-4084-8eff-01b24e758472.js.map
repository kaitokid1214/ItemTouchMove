{"version":3,"sources":["assets/script/favorManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import favorItem from \"./favorItem\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class favorManager extends cc.Component {\n    @property(cc.Prefab)\n    itemPrefab: cc.Prefab = null\n\n    @property(cc.Node)\n    content: cc.Node = null\n\n    @property({type:cc.Integer, tooltip:'content的起始Y座標'})\n    scrollTopY: number = 0\n\n    @property({type:cc.Integer, tooltip:'整個Panel的高度,即可以滾動的最低Y座標'})\n    scrollBottomY: number = 0\n\n    itemList: Array<cc.Node> = []\n\n    allItemStartY = -15 //item的第一個起始位置\n    itemHeight = 30 //一個item的高度\n    itemCount = 10 //item總數\n\n    startScrollUpBoundY = 0 //最上面的滾動Y邊界\n    startScrollDownBoundY = 0 //最下方的滾動Y邊界\n    nowTouchTargetNode: cc.Node\n    onLoad() {\n        console.warn('ken666::onLoad')\n\n        this.content.height = this.itemCount * this.itemHeight\n        this.startScrollUpBoundY = this.allItemStartY + this.itemHeight / 2\n        this.startScrollDownBoundY = -this.node.height + this.itemHeight / 2\n        for (let i = 0; i < this.itemCount; i++) {\n            let item = cc.instantiate(this.itemPrefab)\n            this.itemList.push(item)\n\n            let itemComp = item.getComponent(favorItem)\n            itemComp.itemIndex = i\n            itemComp.setCount()\n            itemComp.editMoveBtn.on(cc.Node.EventType.TOUCH_START, (e: cc.Event.EventTouch) => {\n                let scrollView = this.content.getComponent(cc.ScrollView)\n                scrollView.enabled = false\n                this.nowTouchTargetNode = item\n                this.scheduleOnce(this.setItemOnTouchMove, 1)\n                item.zIndex = 1\n                item.scale = 1.1\n            })\n\n            itemComp.editMoveBtn.on(cc.Node.EventType.TOUCH_END, () => {\n                item.y = this.allItemStartY - (itemComp.itemIndex * this.itemHeight)\n                item.zIndex = 0\n                item.scale = 1\n                let scrollView = this.content.getComponent(cc.ScrollView)\n                this.unschedule(this.setItemOnTouchMove)\n                itemComp.editMoveBtn.off(cc.Node.EventType.TOUCH_MOVE)\n                scrollView.enabled = true\n            })\n\n            itemComp.editMoveBtn.on(cc.Node.EventType.TOUCH_CANCEL, () => {\n                item.y = this.allItemStartY - (itemComp.itemIndex * this.itemHeight)\n                item.zIndex = 0\n                item.scale = 1\n                let scrollView = this.content.getComponent(cc.ScrollView)\n                this.unschedule(this.setItemOnTouchMove)\n                itemComp.editMoveBtn.off(cc.Node.EventType.TOUCH_MOVE)\n                scrollView.enabled = true\n            })\n\n\n            item.parent = this.content\n            item.y = this.allItemStartY - this.itemHeight * i\n        }\n    }\n\n    setItemOnTouchMove() {\n        let itemComp = this.nowTouchTargetNode.getComponent(favorItem)\n        if (itemComp) {\n            itemComp.editMoveBtn.on(cc.Node.EventType.TOUCH_MOVE, (e: cc.Event.EventTouch) => {\n                let touchPos = e.touch.getLocation()\n                let convPos = this.content.convertToNodeSpaceAR(touchPos)\n                let itemSelfStartY = this.allItemStartY - (itemComp.itemIndex * this.itemHeight)//目標的起始Y\n                let moveDeltaY = Math.abs(convPos.y - itemSelfStartY)\n                let isMoveOverHelfHeight = moveDeltaY > this.itemHeight / 2\n                if (isMoveOverHelfHeight) {\n                    let nextItemIndex: number\n                    let nextItem: cc.Node\n                    //滑超過一半的物件高\n                    if (convPos.y < itemSelfStartY) {\n                        //下滑\n                        nextItemIndex = itemComp.itemIndex + 1\n                    } else if (convPos.y > itemSelfStartY) {\n                        //上滑\n                        nextItemIndex = itemComp.itemIndex - 1\n                    }\n\n                    nextItem = this.itemList.find(item => item.getComponent(favorItem).itemIndex === nextItemIndex)\n                    if (nextItem) {\n                        cc.tween(nextItem)\n                            .to(0.3, { y: itemSelfStartY })\n                            .start()\n                        nextItem.getComponent(favorItem).itemIndex = itemComp.itemIndex\n                        itemComp.itemIndex = nextItemIndex\n                    }\n                }\n                this.nowTouchTargetNode.y = convPos.y //移動按住的物件\n\n                if (convPos.y < this.startScrollDownBoundY) {\n                    //超過content下緣, 往下scroll\n                    if (this.content.y >= this.scrollBottomY) {\n                        this.content.y = this.scrollBottomY\n                        return\n                    }\n                    this.content.y += 5\n                } else if (convPos.y + this.content.y / 2 > this.startScrollUpBoundY) {\n                    //超過content上緣, 往上scroll\n                    if (this.content.y <= this.scrollTopY) {\n                        this.content.y = this.scrollTopY\n                        return\n                    }\n                    this.content.y -= 5\n                }\n            })\n        }\n    }\n\n\n\n\n\n}\n"]}